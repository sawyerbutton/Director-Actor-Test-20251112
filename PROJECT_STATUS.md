# é¡¹ç›®å¼€å‘è¿›åº¦ä¸é—ç•™é—®é¢˜

**é¡¹ç›®åç§°**: å‰§æœ¬å™äº‹ç»“æ„åˆ†æç³»ç»Ÿ (Script Narrative Structure Analysis System)
**å½“å‰ç‰ˆæœ¬**: v2.8.0
**æ›´æ–°æ—¥æœŸ**: 2025-11-24
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª (Production Ready)

---

## ğŸ“Š æ•´ä½“è¿›åº¦æ¦‚è§ˆ

| æ¨¡å— | çŠ¶æ€ | å®Œæˆåº¦ | å¤‡æ³¨ |
|------|------|--------|------|
| æ ¸å¿ƒåˆ†æå¼•æ“ | âœ… å®Œæˆ | 100% | ä¸‰é˜¶æ®µæµæ°´çº¿è¿è¡Œç¨³å®š |
| TXT å‰§æœ¬è§£æå™¨ | âœ… å®Œæˆ | 100% | Phase 1-3 å…¨éƒ¨å®Œæˆ |
| Web UI ç•Œé¢ | âœ… å®Œæˆ | 100% | ä¸Šä¼ ã€é¢„è§ˆã€åˆ†æã€ç»“æœå±•ç¤º |
| Mermaid å¯è§†åŒ– | âœ… å®Œæˆ | 100% | TCC å…³ç³»å›¾ã€A/B/C çº¿ç€è‰² |
| LangSmith å¯è§‚æµ‹æ€§ | âœ… å®Œæˆ | 100% | è‡ªåŠ¨è¿½è¸ªã€æ€§èƒ½æŒ‡æ ‡ã€æˆæœ¬ä¼°ç®— |
| A/B æµ‹è¯•æ¡†æ¶ | âœ… å®Œæˆ | 100% | å¤šæä¾›å•†å¯¹æ¯”ã€å‚æ•°æµ‹è¯• |
| Markdown å¯¼å‡º | âœ… å®Œæˆ | 100% | ä¸“ä¸šæŠ¥å‘Š + Mermaid å›¾è¡¨ |
| Docker å®¹å™¨åŒ– | âœ… å®Œæˆ | 100% | docker-compose ä¸€é”®éƒ¨ç½² |
| **Gemini é›†æˆ** | âœ… å®Œæˆ | 100% | **Session 9 æ–°å¢** - è§£å†³å¤§è„šæœ¬é—®é¢˜ |
| **åŠ¨ä½œåˆ†æåè®® (AAP)** | âœ… å®Œæˆ | 100% | **Session 10 æ–°å¢** - Discoverer ä¼˜åŒ– |
| **ç‰ˆæœ¬è¿½è¸ªç³»ç»Ÿ** | âœ… å®Œæˆ | 100% | **Session 11 æ–°å¢** - éƒ¨ç½²ç‰ˆæœ¬è¯†åˆ« |
| **Gemini æ¨¡å‹é€‰æ‹©** | âœ… å®Œæˆ | 100% | **Session 12 æ–°å¢** - Web UI æ¨¡å‹åˆ‡æ¢ |

**æ€»ä½“å®Œæˆåº¦**: 100%

---

## ğŸ“… å¼€å‘å†ç¨‹ (Session 1-12)

### Session 1-6: åŸºç¡€åŠŸèƒ½å¼€å‘ (2025-11-12 ~ 2025-11-13)
- Web ç•Œé¢å¼€å‘ (2,310 è¡Œä»£ç )
- TXT è§£æå™¨ Phase 1-2
- æ ¸å¿ƒåˆ†ææµæ°´çº¿è°ƒè¯•
- LangSmith + A/B æµ‹è¯•é›†æˆ

### Session 7: Web UI åŸºç¡€åŠŸèƒ½ (2025-11-13)
- Stage 2 JSON è§£æä¿®å¤
- Stage 3 change_type éªŒè¯
- WebSocket åºåˆ—åŒ–é—®é¢˜
- å‰ç«¯æ•°æ®ç»“æ„é€‚é…

### Session 8: UX ä¼˜åŒ–ä¸å…³é”®ä¿®å¤ (2025-11-14)
- Stage 3 issue_id éªŒè¯å™¨ (normalize_issue_id)
- Mermaid å¯è§†åŒ–æ¸²æŸ“ä¿®å¤
- TXT è§£æå™¨äº‹ä»¶å¾ªç¯é”™è¯¯ä¿®å¤
- å¼‚æ­¥è§£æå™¨æ”¯æŒ

### Session 9: Gemini 2.5 Flash é›†æˆ (2025-11-19)
- **é—®é¢˜**: DeepSeek 16K max_tokens å¯¼è‡´å¤§è„šæœ¬ Stage 3 JSON æˆªæ–­
- **è§£å†³æ–¹æ¡ˆ**: é›†æˆ Google Gemini 2.5 Flash (1M ä¸Šä¸‹æ–‡, 65K è¾“å‡º)
- **æ–°å¢æ–‡ä»¶**:
  - `test_gemini_api.py` - API è¿é€šæ€§æµ‹è¯•
  - `ref/gemini-integration.md` - é›†æˆæŒ‡å— (13KB)
- **ä¿®æ”¹æ–‡ä»¶**: 9 ä¸ªæ–‡ä»¶, +747 è¡Œä»£ç 
- **æµ‹è¯•ç»“æœ**: ç™¾å¦–1.txt (12åœºæ™¯) æˆåŠŸ, 0 é”™è¯¯, 0 é‡è¯•

### Session 10: Discoverer Actor ä¼˜åŒ– - åŠ¨ä½œåˆ†æåè®® (2025-11-22) ğŸ†•
**ç›®æ ‡**: ä¼˜åŒ– TCC è¯†åˆ«çš„å‡†ç¡®æ€§ï¼Œé€šè¿‡æå–å’Œåˆ†æè¡¨æ¼”æç¤º (performance_notes) å’Œè§†è§‰åŠ¨ä½œ (visual_actions) ä½œä¸ºæƒ…æ„Ÿä¿¡å·è¯æ®

**å®ç°å†…å®¹**:

1. **è¾“å…¥ ETL Pipeline** (Phase 1)
   - æ–°å¢ `PerformanceNote` æ•°æ®æ¨¡å‹ (`prompts/schemas.py`)
   - åœ¨ `Scene` æ¨¡å‹ä¸­æ·»åŠ  `performance_notes` å’Œ `visual_actions` å­—æ®µ
   - TXT è§£æå™¨æ·»åŠ æ­£åˆ™æå–: è¡¨æ¼”æç¤º `è§’è‰²å(æç¤º)` å’Œè§†è§‰åŠ¨ä½œ `â–³/â– /ã€ã€‘`

2. **AI Core Instructions** (Phase 2)
   - æ›´æ–° `prompts/stage1_discoverer.md` ç‰ˆæœ¬è‡³ v2.6.0-AAP
   - æ–°å¢ Section 6: Action Analysis Protocol (AAP)
   - åŠ¨ä½œåˆ†ç±»: emotional_signal vs noise

3. **Middleware Logic** (Phase 3)
   - `filter_low_coverage_tccs()`: TCC è¦†ç›–ç‡è¿‡æ»¤ (é˜ˆå€¼ â‰¥15%)
   - `check_antagonist_mutual_exclusion()`: å¯¹æ‰‹äº’æ–¥æ£€æŸ¥ï¼Œé˜²æ­¢é•œåƒ TCC è¢«æ‹†åˆ†

4. **Validation Layer** (Phase 4)
   - `validate_tcc_scene_evidence()`: åŸå­åœºæ™¯åå‘éªŒè¯
   - `_has_keyword_overlap()`: å…³é”®è¯é‡å æ£€æµ‹ (min_overlap=1)

5. **ç‹¬ç«‹ Prompt æ–‡ä»¶** (Phase 5)
   - `prompts/action_classifier.md` (Prompt A) - åŠ¨ä½œåˆ†ç±»å™¨
   - `prompts/action_analyzer.md` (Prompt B) - åŠ¨ä½œ-TCC è¯æ®åˆ†æå™¨

6. **å‰ç«¯ä¼˜åŒ–** (Phase 6)
   - ä¿®å¤ Stage 3 "ç†ç”±: N/A" æ˜¾ç¤ºé—®é¢˜
   - æ”¹è¿›ä¿®æ”¹æ—¥å¿—å±•ç¤ºï¼Œæ˜¾ç¤ºæœ‰æ„ä¹‰çš„æ“ä½œæè¿°

**ä¿®å¤çš„é—®é¢˜**:
- `RelationChange` å¯¹è±¡å±æ€§è®¿é—®é”™è¯¯ (`from_state` â†’ `from_`)
- éªŒè¯å±‚è¿‡äºä¸¥æ ¼å¯¼è‡´æ‰€æœ‰ TCC è¢«è¿‡æ»¤ (è°ƒæ•´ min_overlap ä» 2 åˆ° 1)
- Stage 3 ä¿®æ”¹æ—¥å¿— "ç†ç”±: N/A" æ˜¾ç¤ºä¸å‹å¥½
- **LLM è¾“å‡ºä¸­è‹±æ–‡æ··æ­** - æ·»åŠ  Language Requirement å¼ºåˆ¶ä¸­æ–‡è¾“å‡º

**æ–°å¢æ–‡ä»¶**:
- `prompts/action_classifier.md` - åŠ¨ä½œåˆ†ç±»æç¤ºè¯ (127 è¡Œ)
- `prompts/action_analyzer.md` - åŠ¨ä½œåˆ†ææç¤ºè¯ (150 è¡Œ)

**ä¿®æ”¹æ–‡ä»¶**: 7 ä¸ªæ ¸å¿ƒæ–‡ä»¶
- `prompts/schemas.py` - +150 è¡Œ (æ–°æ¨¡å‹ + ä¸­é—´ä»¶ + éªŒè¯å‡½æ•°)
- `prompts/stage1_discoverer.md` - æ·»åŠ  Language Requirement ä¸­æ–‡è¾“å‡ºè¦æ±‚
- `prompts/stage2_auditor.md` - æ·»åŠ  Language Requirement ä¸­æ–‡è¾“å‡ºè¦æ±‚
- `prompts/stage3_modifier.md` - æ·»åŠ  Language Requirement ä¸­æ–‡è¾“å‡ºè¦æ±‚
- `src/parser/txt_parser.py` - +80 è¡Œ (ETL æå–é€»è¾‘)
- `src/pipeline.py` - +40 è¡Œ (ä¸­é—´ä»¶ + éªŒè¯é›†æˆ)
- `static/js/results.js` - +30 è¡Œ (å‰ç«¯æ˜¾ç¤ºä¼˜åŒ–)

**æµ‹è¯•ç»“æœ**:
- 5 åœºæ™¯å‰§æœ¬: 2 TCCs è¯†åˆ« (å…¨ä¸­æ–‡), è¦†ç›–ç‡ 60%-80%
- TCC è¾“å‡º: "ç‰é¼ ç²¾å¯»æ±‚åˆ›ä¸šåŠæ”¯æŒå…¶ç”µå•†å¹³å°é¡¹ç›®", "é˜¿è ¢å¯¹ç‰é¼ ç²¾çš„å¶åƒå´‡æ‹œä¸è¿½éš"
- ä¸­é—´ä»¶æ—¥å¿—: å¯¹æ‰‹æ£€æŸ¥é€šè¿‡, è¦†ç›–ç‡è¿‡æ»¤é€šè¿‡
- éªŒè¯å±‚æ—¥å¿—: åœºæ™¯è¯æ®éªŒè¯, éƒ¨åˆ†åœºæ™¯æ ‡è®°ä½ç½®ä¿¡åº¦
- Stage 2/3: æ­£å¸¸æ‰§è¡Œ, A-line æ’å, 1 ä¸ªé—®é¢˜ä¿®å¤
- æ€»è€—æ—¶: 58.56s, 0 é”™è¯¯, 0 é‡è¯•

### Session 11: ç‰ˆæœ¬è¿½è¸ªç³»ç»Ÿ + Gemini 3 Pro é€‚é… (2025-11-24) ğŸ†•
**ç›®æ ‡**: è§£å†³ ECS éƒ¨ç½²æ—¶éš¾ä»¥è¯†åˆ«ç‰ˆæœ¬çš„é—®é¢˜ï¼Œå¹¶é€‚é… Gemini 3 Pro çš„ç‰¹æ€§

**å®ç°å†…å®¹**:

1. **ç‰ˆæœ¬è¿½è¸ªç³»ç»Ÿ**
   - æ–°å¢ `src/version.py` - é›†ä¸­ç®¡ç†ç‰ˆæœ¬ä¿¡æ¯
   - å¥åº·æ£€æŸ¥ç«¯ç‚¹ `/health` è¿”å›ç‰ˆæœ¬å’Œ git ä¿¡æ¯
   - Web UI é¡µè„šæ˜¾ç¤ºç‰ˆæœ¬å·å’Œ commit hash
   - `deploy.sh` æ–°å¢ `version` å‘½ä»¤æŸ¥çœ‹ç‰ˆæœ¬
   - Docker é•œåƒæ”¯æŒ `APP_VERSION` å˜é‡

2. **Gemini 3 Pro å“åº”æ ¼å¼é€‚é…**
   - ä¿®å¤å¤šéƒ¨åˆ†å“åº”è§£æ (`[{'type': 'text', 'text': '...'}]`)
   - `src/parser/llm_enhancer.py:_parse_json_response()` æ”¯æŒåˆ—è¡¨æ ¼å¼

3. **Gemini 3 Pro æ…¢å“åº”é€‚é…**
   - LLM è°ƒç”¨è¶…æ—¶å¢è‡³ 120 ç§’
   - Docker healthcheck: interval 60s, timeout 30s, retries 5, start_period 120s

**æ–°å¢æ–‡ä»¶**:
- `src/version.py` - ç‰ˆæœ¬ä¿¡æ¯æ¨¡å—
- `ref/version-tracking.md` - ç‰ˆæœ¬è¿½è¸ªæŒ‡å—

**ä¿®æ”¹æ–‡ä»¶**:
- `src/web/app.py` - å¥åº·ç«¯ç‚¹è¿”å›ç‰ˆæœ¬
- `templates/base.html` - é¡µè„šç‰ˆæœ¬æ˜¾ç¤º
- `docker-compose.yml` - healthcheck ä¼˜åŒ–
- `src/pipeline.py` - LLM timeout é…ç½®
- `src/parser/llm_enhancer.py` - å¤šéƒ¨åˆ†å“åº”å¤„ç†
- `scripts/deploy.sh` - version å‘½ä»¤

### Session 12: Gemini æ¨¡å‹é€‰æ‹©åŠŸèƒ½ (2025-11-24) âœ… å®Œæˆ
**ç›®æ ‡**: åœ¨ Web UI ä¸Šæ”¯æŒé€‰æ‹©ä¸åŒçš„ Gemini æ¨¡å‹ç‰ˆæœ¬

**èƒŒæ™¯**:
- ç”¨æˆ·éœ€è¦æ ¹æ®åœºæ™¯é€‰æ‹©åˆé€‚çš„ Gemini æ¨¡å‹
- ä¸åŒæ¨¡å‹æœ‰ä¸åŒçš„é€Ÿåº¦å’Œèƒ½åŠ›ç‰¹æ€§

**å®ç°å†…å®¹**:

1. **Web UI ä¿®æ”¹** (`templates/index.html`)
   - å½“é€‰æ‹© Gemini æä¾›å•†æ—¶ï¼Œæ˜¾ç¤ºæ¨¡å‹å­é€‰é¡¹ä¸‹æ‹‰æ¡†
   - é€‰é¡¹: Gemini 2.5 Flash (æ¨è) / Gemini 2.5 Pro / Gemini 2.0 Flash
   - åŠ¨æ€æ˜¾ç¤º/éšè—æ¨¡å‹é€‰æ‹©å™¨

2. **å‰ç«¯é€»è¾‘** (`static/js/upload.js`)
   - ç›‘å¬ provider å˜åŒ–ï¼Œè‡ªåŠ¨æ˜¾ç¤º/éšè— Gemini æ¨¡å‹é€‰æ‹©å™¨
   - æäº¤æ—¶è‡ªåŠ¨è·å–é€‰ä¸­çš„ Gemini æ¨¡å‹
   - æ›´æ–° provider æç¤ºä¿¡æ¯

3. **Pipeline ä¼˜åŒ–** (`src/pipeline.py`)
   - é»˜è®¤æ¨¡å‹: `gemini-2.5-flash`
   - æ¨¡å‹ç‰¹å®š timeout: Pro æ¨¡å‹ 120s, Flash æ¨¡å‹ 60s

4. **éƒ¨ç½²è„šæœ¬ä¿®å¤** (`scripts/deploy.sh`)
   - ä¿®å¤ APP_VERSION æœªä¼ é€’ç»™ docker-compose çš„é—®é¢˜
   - æ–°å¢ `rebuild` å‘½ä»¤å¼ºåˆ¶é‡å»ºé•œåƒ

**ä¿®å¤çš„é—®é¢˜**:
- æ¨¡å‹åç§°é”™è¯¯: `gemini-2.5-flash-preview-05-20` â†’ `gemini-2.5-flash`
- docker-compose æœªæ¥æ”¶ APP_VERSION å¯¼è‡´ä½¿ç”¨é”™è¯¯é•œåƒ
- æ–°å¢ `--no-cache` é‡å»ºé€‰é¡¹

**å¯ç”¨ Gemini æ¨¡å‹**:
- `gemini-2.5-flash`: å¿«é€Ÿå“åº”ï¼Œæ¨èç”¨äºä¸€èˆ¬åˆ†æ
- `gemini-2.5-pro`: é«˜çº§æ¨ç†ï¼Œé€‚åˆå¤æ‚åˆ†æ
- `gemini-2.0-flash`: ä¸Šä¸€ä»£ Flash æ¨¡å‹

---

## âœ… å·²å®ŒæˆåŠŸèƒ½æ¸…å•

### æ ¸å¿ƒåˆ†æå¼•æ“
- [x] Stage 1 (Discoverer): TCC è¯†åˆ« (ç½®ä¿¡åº¦ 85-95%)
- [x] Stage 2 (Auditor): A/B/C çº¿æ’å
- [x] Stage 3 (Modifier): ç»“æ„é—®é¢˜ä¿®å¤
- [x] å¤š LLM æä¾›å•†æ”¯æŒ (DeepSeek, Claude, OpenAI, **Gemini**)
- [x] æ™ºèƒ½ JSON è§£æå’Œé”™è¯¯æ¢å¤
- [x] é‡è¯•æœºåˆ¶ (æœ€å¤š 3 æ¬¡)
- [x] **åŠ¨ä½œåˆ†æåè®® (AAP)**: è¡¨æ¼”æç¤º + è§†è§‰åŠ¨ä½œæå– (**Session 10 æ–°å¢**)
- [x] **TCC ä¸­é—´ä»¶**: è¦†ç›–ç‡è¿‡æ»¤ + å¯¹æ‰‹äº’æ–¥æ£€æŸ¥ (**Session 10 æ–°å¢**)
- [x] **åœºæ™¯éªŒè¯å±‚**: åŸå­åå‘éªŒè¯é˜²æ­¢è¯­ä¹‰å¹»è§‰ (**Session 10 æ–°å¢**)

### TXT å‰§æœ¬è§£æå™¨
- [x] Phase 1: åŸºç¡€è§„åˆ™è§£æ (åœºæ™¯åˆ†å‰²ã€è§’è‰²æå–)
- [x] Phase 2: LLM è¯­ä¹‰å¢å¼º (åœºæ™¯ä½¿å‘½ã€å…³é”®äº‹ä»¶ã€å› æœå…³ç³»)
- [x] Phase 3: Web é›†æˆ (ä¸Šä¼ ã€é¢„è§ˆã€ç»§ç»­åˆ†æ)
- [x] å¤šæ ¼å¼åœºæ™¯å¤´æ”¯æŒ (S01, åœºæ™¯ 1, ç¬¬ä¸€åœº ç­‰)
- [x] è¿›åº¦å›è°ƒå’Œ WebSocket å®æ—¶æ›´æ–°

### Web UI
- [x] æ–‡ä»¶ä¸Šä¼  (JSON/TXT)
- [x] TXT è§£æé¢„è§ˆ (4 æ ‡ç­¾é¡µ: æ¦‚è§ˆã€åœºæ™¯ã€è§’è‰²ã€åŸå§‹ JSON)
- [x] ä¸‰é˜¶æ®µåˆ†æé¡µé¢
- [x] ç»“æœå±•ç¤º (TCC åˆ—è¡¨ã€é—®é¢˜åˆ—è¡¨ã€ä¿®å¤å»ºè®®)
- [x] Mermaid å¯è§†åŒ– (A/B/C çº¿é¢œè‰²ç¼–ç )
- [x] Markdown æŠ¥å‘Šå¯¼å‡º

### åŸºç¡€è®¾æ–½
- [x] Docker å®¹å™¨åŒ– (docker-compose)
- [x] ç¯å¢ƒå˜é‡é…ç½® (.env)
- [x] LangSmith å¯è§‚æµ‹æ€§
- [x] A/B æµ‹è¯•æ¡†æ¶
- [x] å•å…ƒæµ‹è¯• (44/44 é€šè¿‡)
- [x] ç»¼åˆæ–‡æ¡£ (120KB+ across 15+ files)

---

## âš ï¸ å·²çŸ¥é—ç•™é—®é¢˜

### 0. Gemini 3 Pro å“åº”æ—¶é—´æ…¢ (v2.7.0 æ–°å¢) ğŸ†•
**ä¸¥é‡ç¨‹åº¦**: ä¸­
**çŠ¶æ€**: å·²é€‚é… (v2.7.0)
**æè¿°**:
- Gemini 3 Pro (`gemini-3-pro-preview`) å•æ¬¡è¯·æ±‚å“åº”æ—¶é—´ ~15-20 ç§’
- å¯¹æ¯”: DeepSeek ~2 ç§’/è¯·æ±‚
- TXT LLM å¢å¼ºè§£æ (3 åœºæ™¯ Ã— 5 è°ƒç”¨) éœ€è¦ 4-5 åˆ†é’Ÿ
- å¯èƒ½å¯¼è‡´ Docker healthcheck è¶…æ—¶ï¼Œå®¹å™¨çŠ¶æ€å˜ä¸º unhealthy

**æ ¹æœ¬åŸå› **:
- Gemini 3 Pro æ˜¯é¢„è§ˆç‰ˆï¼Œå…·æœ‰é«˜çº§æ¨ç†èƒ½åŠ›ä½†å“åº”è¾ƒæ…¢
- æ¯ä¸ªåœºæ™¯éœ€è¦ 5 æ¬¡ LLM è°ƒç”¨ (scene_mission, setup_payoff, relation_changes, info_changes, key_events)

**å·²å®æ–½çš„è§£å†³æ–¹æ¡ˆ** (v2.7.0):
1. âœ… LLM è°ƒç”¨è¶…æ—¶å¢åŠ è‡³ 120 ç§’ (`src/pipeline.py:315`)
2. âœ… Docker healthcheck è°ƒæ•´:
   - `interval`: 30s â†’ 60s
   - `timeout`: 10s â†’ 30s
   - `retries`: 3 â†’ 5
   - `start_period`: 40s â†’ 120s
3. âœ… Gemini å¤šéƒ¨åˆ†å“åº”æ ¼å¼å¤„ç† (`src/parser/llm_enhancer.py:411-428`)

**æ½œåœ¨ä¼˜åŒ–æ–¹å‘**:
1. å¹¶è¡ŒåŒ– LLM è°ƒç”¨ (5 ä¸ªæå–ä»»åŠ¡å¯å¹¶è¡Œæ‰§è¡Œ)
2. æ·»åŠ è¿›åº¦æŒ‡ç¤ºå™¨ï¼Œæ˜¾ç¤ºé¢„è®¡å‰©ä½™æ—¶é—´
3. è€ƒè™‘ä½¿ç”¨ Gemini 2.5 Flash ä½œä¸º TXT è§£æçš„å¤‡é€‰ï¼ˆæ›´å¿«ä½†æ¨ç†èƒ½åŠ›ç¨å¼±ï¼‰

**ç›¸å…³æ–‡ä»¶**:
- `src/pipeline.py:308-316` - Gemini LLM é…ç½®
- `docker-compose.yml:52-57` - healthcheck é…ç½®
- `src/parser/llm_enhancer.py:411-428` - å“åº”æ ¼å¼å¤„ç†

---

### 1. å•åœºæ™¯å‰§æœ¬åˆ†æå¤±è´¥
**ä¸¥é‡ç¨‹åº¦**: ä¸­
**çŠ¶æ€**: å·²çŸ¥é™åˆ¶
**æè¿°**:
- å½“å‰§æœ¬åªæœ‰ 1 ä¸ªåœºæ™¯æ—¶, Stage 1 æ— æ³•è¯†åˆ« TCC
- é”™è¯¯ä¿¡æ¯: `List should have at least 1 item after validation, not 0`
- ç³»ç»Ÿä¼šé‡è¯• 3 æ¬¡åå¤±è´¥

**æ ¹æœ¬åŸå› **:
- `prompts/stage1_discoverer.md` ç¬¬ 154 è¡Œè§„å®š: "Each TCC must appear in at least 2 scenes"
- TCC (æˆå‰§å†²çªé“¾) çš„å®šä¹‰è¦æ±‚è·¨è¶Šå¤šä¸ªåœºæ™¯çš„å™äº‹çº¿

**æ½œåœ¨è§£å†³æ–¹æ¡ˆ**:
1. ä¿®æ”¹ prompt å…è®¸å•åœºæ™¯ TCC (é™ä½ `minimum 2` ä¸º `minimum 1`)
2. æ·»åŠ å‰ç½®æ£€æŸ¥, åœºæ™¯æ•° < 2 æ—¶ç»™å‡ºå‹å¥½æç¤º
3. ä¸ºå•åœºæ™¯æä¾›ç®€åŒ–åˆ†ææ¨¡å¼

**å½±å“èŒƒå›´**: ä»…å½±å“æçŸ­å‰§æœ¬ (1 åœºæ™¯)

**ç›¸å…³æ–‡ä»¶**:
- `prompts/stage1_discoverer.md:34` - "minimum 2" è§„åˆ™
- `prompts/stage1_discoverer.md:154` - æœ€å°è¦æ±‚è¯´æ˜

---

### 2. Mermaid å›¾è¡¨åœ¨æŸäº›æµè§ˆå™¨æ¸²æŸ“å»¶è¿Ÿ
**ä¸¥é‡ç¨‹åº¦**: ä½
**çŠ¶æ€**: å·²çŸ¥é™åˆ¶
**æè¿°**:
- åœ¨ Safari å’Œéƒ¨åˆ†æ—§ç‰ˆ Chrome ä¸Š, Mermaid å›¾è¡¨é¦–æ¬¡åŠ è½½æ—¶å¯èƒ½æ˜¾ç¤ºä»£ç è€Œéå›¾è¡¨
- åˆ·æ–°é¡µé¢åæ­£å¸¸æ˜¾ç¤º

**æ½œåœ¨è§£å†³æ–¹æ¡ˆ**:
1. å¢åŠ æ¸²æŸ“å»¶è¿Ÿæ—¶é—´
2. æ·»åŠ åŠ è½½çŠ¶æ€æŒ‡ç¤ºå™¨
3. ä½¿ç”¨æœåŠ¡ç«¯æ¸²æŸ“æ›¿ä»£å®¢æˆ·ç«¯æ¸²æŸ“

**ç›¸å…³æ–‡ä»¶**:
- `static/js/results.js:348-382` - Mermaid æ¸²æŸ“é€»è¾‘
- `templates/results.html:5-16` - Mermaid åˆå§‹åŒ–

---

### 3. LLM è¯­ä¹‰å¢å¼ºæˆæœ¬è¾ƒé«˜
**ä¸¥é‡ç¨‹åº¦**: ä½
**çŠ¶æ€**: è®¾è®¡æƒè¡¡
**æè¿°**:
- TXT è§£æçš„ LLM å¢å¼ºæ¨¡å¼éœ€è¦ 5 æ¬¡ LLM è°ƒç”¨/åœºæ™¯
- å¯¹äº 12 åœºæ™¯å‰§æœ¬ = 60 æ¬¡ LLM è°ƒç”¨
- å¢åŠ å¤„ç†æ—¶é—´å’Œ API æˆæœ¬

**å½“å‰ç¼“è§£æªæ–½**:
- æä¾› "ç¦ç”¨ LLM å¢å¼º" é€‰é¡¹
- åŸºç¡€è§„åˆ™è§£æä¸éœ€è¦ LLM

**æ½œåœ¨ä¼˜åŒ–**:
1. æ‰¹é‡å¤„ç†å¤šä¸ªåœºæ™¯
2. ç¼“å­˜å¸¸è§æ¨¡å¼
3. ä½¿ç”¨æ›´ä¾¿å®œçš„æ¨¡å‹ (å¦‚ Gemini Flash)

---

### 4. å¤§æ–‡ä»¶ä¸Šä¼ å¯èƒ½è¶…æ—¶
**ä¸¥é‡ç¨‹åº¦**: ä½
**çŠ¶æ€**: å¾…ä¼˜åŒ–
**æè¿°**:
- éå¸¸å¤§çš„å‰§æœ¬æ–‡ä»¶ (>1MB) å¯èƒ½å¯¼è‡´ä¸Šä¼ è¶…æ—¶
- è¿™æ˜¯æç«¯è¾¹ç•Œæƒ…å†µ, æ™®é€šå‰§æœ¬é€šå¸¸ <100KB

**æ½œåœ¨è§£å†³æ–¹æ¡ˆ**:
1. å®ç°åˆ†å—ä¸Šä¼ 
2. å¢åŠ è¶…æ—¶æ—¶é—´
3. æ·»åŠ æ–‡ä»¶å¤§å°é™åˆ¶å’Œè­¦å‘Š

---

### 5. é”™è¯¯ä¿¡æ¯å›½é™…åŒ–
**ä¸¥é‡ç¨‹åº¦**: ä½
**çŠ¶æ€**: å¾…å®Œå–„
**æè¿°**:
- éƒ¨åˆ†é”™è¯¯ä¿¡æ¯ä¸ºè‹±æ–‡
- ç”¨æˆ·ç•Œé¢ä¸»è¦ä¸ºä¸­æ–‡, å­˜åœ¨ä¸ä¸€è‡´

**æ½œåœ¨è§£å†³æ–¹æ¡ˆ**:
1. æ·»åŠ  i18n å›½é™…åŒ–æ”¯æŒ
2. ç»Ÿä¸€ä½¿ç”¨ä¸­æ–‡é”™è¯¯ä¿¡æ¯

---

## ğŸ”® æœªæ¥æ”¹è¿›å»ºè®®

### çŸ­æœŸ (1-2 å‘¨)
1. [ ] æ·»åŠ å•åœºæ™¯å‰§æœ¬çš„å‹å¥½é”™è¯¯æç¤º
2. [ ] ä¼˜åŒ– Mermaid æ¸²æŸ“å…¼å®¹æ€§
3. [ ] ç»Ÿä¸€é”™è¯¯ä¿¡æ¯ä¸ºä¸­æ–‡

### ä¸­æœŸ (1-2 æœˆ)
1. [ ] å®ç° LLM è°ƒç”¨æ‰¹å¤„ç†ä»¥é™ä½æˆæœ¬
2. [ ] æ·»åŠ åˆ†æç»“æœå†å²è®°å½•
3. [ ] æ”¯æŒå¤šå‰§æœ¬æ‰¹é‡åˆ†æ
4. [ ] å®ç°ç”¨æˆ·ç™»å½•å’Œé¡¹ç›®ç®¡ç†

### é•¿æœŸ (3+ æœˆ)
1. [ ] æ”¯æŒæ›´å¤šå‰§æœ¬æ ¼å¼ (Final Draft, Celtx)
2. [ ] æ·»åŠ åä½œç¼–è¾‘åŠŸèƒ½
3. [ ] é›†æˆå‰§æœ¬å†™ä½œå»ºè®®
4. [ ] ç§»åŠ¨ç«¯é€‚é…

---

## ğŸ“ å…³é”®æ–‡ä»¶ç´¢å¼•

### é…ç½®æ–‡ä»¶
| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `.env.example` | ç¯å¢ƒå˜é‡æ¨¡æ¿ |
| `docker-compose.yml` | Docker ç¼–æ’é…ç½® |
| `requirements.txt` | Python ä¾èµ– |

### æ ¸å¿ƒä»£ç 
| æ–‡ä»¶ | è¯´æ˜ | å…³é”®è¡Œ |
|------|------|--------|
| `src/pipeline.py` | åˆ†ææµæ°´çº¿ | 288-303: Gemini å·¥å‚, ä¸­é—´ä»¶+éªŒè¯é›†æˆ |
| `src/web/app.py` | Web åç«¯ | 122-131: æä¾›å•†é…ç½® |
| `src/parser/txt_parser.py` | TXT è§£æå™¨ | è¡¨æ¼”æç¤º/è§†è§‰åŠ¨ä½œæå– |
| `src/parser/llm_enhancer.py` | LLM å¢å¼ºå™¨ | - |
| `prompts/stage1_discoverer.md` | TCC è¯†åˆ«æç¤ºè¯ (v2.6.0-AAP) | Section 6: AAP |
| `prompts/action_classifier.md` | åŠ¨ä½œåˆ†ç±»å™¨ (Prompt A) | **Session 10 æ–°å¢** |
| `prompts/action_analyzer.md` | åŠ¨ä½œåˆ†æå™¨ (Prompt B) | **Session 10 æ–°å¢** |
| `prompts/schemas.py` | æ•°æ®æ¨¡å‹ + ä¸­é—´ä»¶ + éªŒè¯ | PerformanceNote, éªŒè¯å‡½æ•° |

### æ–‡æ¡£
| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `CLAUDE.md` | AI åŠ©æ‰‹å¯¼èˆª (39KB) |
| `ref/gemini-integration.md` | Gemini é›†æˆæŒ‡å— (13KB) |
| `ref/txt-parser-guide.md` | TXT è§£æå™¨æŒ‡å— (20KB) |
| `DEVELOPMENT_LOG.md` | å¼€å‘æ—¥å¿— |

### æµ‹è¯•
| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `test_gemini_api.py` | Gemini API æµ‹è¯• |
| `tests/test_schemas.py` | Schema å•å…ƒæµ‹è¯• |
| `tests/test_golden_dataset.py` | é›†æˆæµ‹è¯• |

---

## ğŸ§ª æµ‹è¯•çŠ¶æ€

### å•å…ƒæµ‹è¯•
```bash
pytest tests/ -v
# Result: 44 passed, 3 skipped (LLM integration tests)
# Status: âœ… 100% pass rate
```

### ç«¯åˆ°ç«¯æµ‹è¯•
```bash
# å¤§è„šæœ¬æµ‹è¯• (12 åœºæ™¯)
python -m src.cli analyze examples/golden/ç™¾å¦–_ep09_s01-s05.json --provider gemini
# Stage 1: âœ… Success (3 TCCs, 19.66s)
# Stage 2: âœ… Success (A/B/C ranking, 27.40s)
# Stage 3: âœ… Success (6 issues fixed, 59.84s)
# Total: 106.90s, 0 errors, 0 retries
```

### API è¿é€šæ€§æµ‹è¯•
```bash
python test_gemini_api.py
# âœ… Gemini 2.5 Flash: PASSED
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### å¸¸è§é—®é¢˜å¿«é€Ÿè§£å†³

| é—®é¢˜ | è§£å†³æ–¹æ¡ˆ |
|------|----------|
| API Key é”™è¯¯ | æ£€æŸ¥ `.env` æ–‡ä»¶ |
| Docker å¯åŠ¨å¤±è´¥ | `docker-compose down && docker-compose up -d` |
| Gemini é…é¢è¶…é™ | ç­‰å¾… 24 å°æ—¶æˆ–æ›´æ¢ API Key |
| TXT è§£æå¤±è´¥ | æ£€æŸ¥åœºæ™¯å¤´æ ¼å¼ (éœ€è¦ S01/åœºæ™¯ 1 ç­‰) |
| Stage 1 å¤±è´¥ | ç¡®ä¿å‰§æœ¬è‡³å°‘æœ‰ 2 ä¸ªåœºæ™¯ |

### è°ƒè¯•å‘½ä»¤
```bash
# æŸ¥çœ‹ Docker æ—¥å¿—
docker-compose logs -f web

# æµ‹è¯• Gemini API
python test_gemini_api.py

# è¿è¡Œå•å…ƒæµ‹è¯•
pytest tests/ -v

# æ£€æŸ¥ç¯å¢ƒå˜é‡
cat .env | grep -E "LLM_PROVIDER|GOOGLE_API_KEY"
```

---

## ğŸ“ å˜æ›´æ—¥å¿—

### v2.8.0 (2025-11-24) - Session 12 âœ… å®Œæˆ
- ğŸ†• **Gemini æ¨¡å‹é€‰æ‹©**: Web UI æ”¯æŒé€‰æ‹© Gemini 2.5 Flash / 2.5 Pro / 2.0 Flash
- ğŸ†• **æ¨¡å‹å­é€‰é¡¹**: å½“é€‰æ‹© Gemini æ—¶æ˜¾ç¤ºæ¨¡å‹ç‰ˆæœ¬ä¸‹æ‹‰æ¡†
- ğŸ†• **åŠ¨æ€ timeout**: Pro æ¨¡å‹ 120s, Flash æ¨¡å‹ 60s
- ğŸ”§ **éƒ¨ç½²ä¿®å¤**: APP_VERSION ä¼ é€’ç»™ docker-compose
- ğŸ”§ **æ¨¡å‹åç§°ä¿®å¤**: ä½¿ç”¨æ­£ç¡®çš„æ¨¡å‹ ID (gemini-2.5-flash)
- ğŸ”§ **æ–°å¢ rebuild å‘½ä»¤**: `./scripts/deploy.sh rebuild` å¼ºåˆ¶é‡å»º
- ğŸ“„ æ›´æ–° `templates/index.html` - æ·»åŠ æ¨¡å‹é€‰æ‹© UI
- ğŸ“„ æ›´æ–° `static/js/upload.js` - å‰ç«¯æ¨¡å‹é€‰æ‹©é€»è¾‘
- ğŸ“„ æ›´æ–° `src/pipeline.py` - æ¨¡å‹é…ç½®å’Œ timeout
- ğŸ“„ æ›´æ–° `scripts/deploy.sh` - rebuild å‘½ä»¤å’Œ APP_VERSION ä¼ é€’
- ğŸ“„ æ›´æ–° `docker-compose.yml` - é»˜è®¤ç‰ˆæœ¬ 2.8.0

### v2.7.0 (2025-11-24) - Session 11
- ğŸ†• **ç‰ˆæœ¬è¿½è¸ªç³»ç»Ÿ**: é›†ä¸­ç®¡ç†ç‰ˆæœ¬ä¿¡æ¯ï¼Œä¾¿äºéƒ¨ç½²è¯†åˆ«
- ğŸ†• æ–°å¢ `src/version.py` - ç‰ˆæœ¬ä¿¡æ¯æ¨¡å—
- ğŸ†• æ–°å¢ `ref/version-tracking.md` - ç‰ˆæœ¬è¿½è¸ªæŒ‡å—
- ğŸ”§ å¥åº·ç«¯ç‚¹ `/health` è¿”å›ç‰ˆæœ¬å’Œ git ä¿¡æ¯
- ğŸ”§ Web UI é¡µè„šæ˜¾ç¤ºç‰ˆæœ¬å·å’Œ commit hash
- ğŸ”§ **Gemini 3 Pro é€‚é…**: ä¿®å¤å¤šéƒ¨åˆ†å“åº”æ ¼å¼è§£æ
- ğŸ”§ **è¶…æ—¶ä¼˜åŒ–**: LLM è°ƒç”¨ 120sï¼Œhealthcheck ä¼˜åŒ–

### v2.6.0 (2025-11-22) - Session 10
- ğŸ†• **åŠ¨ä½œåˆ†æåè®® (AAP)**: æå–è¡¨æ¼”æç¤ºå’Œè§†è§‰åŠ¨ä½œä½œä¸º TCC è¯æ®
- ğŸ†• **TCC ä¸­é—´ä»¶å±‚**: è¦†ç›–ç‡è¿‡æ»¤ (â‰¥15%) + å¯¹æ‰‹äº’æ–¥æ£€æŸ¥
- ğŸ†• **åœºæ™¯éªŒè¯å±‚**: åŸå­åå‘éªŒè¯é˜²æ­¢è¯­ä¹‰å¹»è§‰
- ğŸ†• æ–°å¢ `prompts/action_classifier.md` (Prompt A)
- ğŸ†• æ–°å¢ `prompts/action_analyzer.md` (Prompt B)
- ğŸ†• **ä¸­æ–‡è¾“å‡ºå¼ºåˆ¶**: æ‰€æœ‰ Stage prompt æ·»åŠ  Language Requirement
- ğŸ”§ ä¿®å¤ `RelationChange` å±æ€§è®¿é—®é”™è¯¯
- ğŸ”§ ä¼˜åŒ–éªŒè¯å±‚å‚æ•° (min_overlap: 2â†’1)
- ğŸ”§ æ”¹è¿› Stage 3 ä¿®æ”¹æ—¥å¿—å‰ç«¯æ˜¾ç¤º
- ğŸ”§ ä¿®å¤ TCC å†…å®¹ä¸­è‹±æ–‡æ··æ­é—®é¢˜

### v2.5.0 (2025-11-19) - Session 9
- ğŸ†• é›†æˆ Google Gemini 2.5 Flash
- ğŸ”§ è§£å†³ DeepSeek å¤§è„šæœ¬ JSON æˆªæ–­é—®é¢˜
- ğŸ“„ æ–°å¢ `ref/gemini-integration.md` æ–‡æ¡£
- ğŸ§ª æ–°å¢ `test_gemini_api.py` API æµ‹è¯•è„šæœ¬

### v2.4.1 (2025-11-14) - Session 8
- ğŸ”§ ä¿®å¤ Stage 3 issue_id éªŒè¯
- ğŸ”§ ä¿®å¤ Mermaid å¯è§†åŒ–æ¸²æŸ“
- ğŸ”§ ä¿®å¤ TXT è§£æå™¨äº‹ä»¶å¾ªç¯é”™è¯¯

### v2.4.0 (2025-11-13) - Session 6-7
- ğŸ†• TXT å‰§æœ¬è§£æå™¨ (Phase 1-3)
- ğŸ†• Web UI TXT ä¸Šä¼ å’Œé¢„è§ˆ
- ğŸ”§ Stage 2 JSON è§£æä¼˜åŒ–

### v2.3.0 (2025-11-13) - Session 5
- ğŸ†• Markdown æŠ¥å‘Šå¯¼å‡º
- ğŸ†• Mermaid TCC å…³ç³»å›¾

### v2.2.0 (2025-11-12) - Session 3-4
- ğŸ†• LangSmith å¯è§‚æµ‹æ€§
- ğŸ†• A/B æµ‹è¯•æ¡†æ¶

### v2.1.0 (2025-11-12) - Session 1-2
- ğŸ†• Web UI ç•Œé¢
- ğŸ†• Docker å®¹å™¨åŒ–

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.2
**æœ€åæ›´æ–°**: 2025-11-24
**ç»´æŠ¤è€…**: AI Assistant (Claude Code)
