# ECS éƒ¨ç½²æ£€æŸ¥æ¸…å•

## ğŸ“‹ éƒ¨ç½²å‰æ£€æŸ¥

### æœåŠ¡å™¨ç¯å¢ƒ
- [ ] ECS æœåŠ¡å™¨å¯è®¿é—®ï¼ˆSSH è¿æ¥æ­£å¸¸ï¼‰
- [ ] Docker å·²å®‰è£…å¹¶è¿è¡Œï¼ˆ`docker --version`ï¼‰
- [ ] Docker Compose å·²å®‰è£…ï¼ˆ`docker-compose --version`ï¼‰
- [ ] Nginx å·²å®‰è£…ï¼ˆå¦‚éœ€åå‘ä»£ç†ï¼‰ï¼ˆ`nginx -v`ï¼‰
- [ ] ç£ç›˜ç©ºé—´å……è¶³ï¼ˆè‡³å°‘ 20GB å¯ç”¨ï¼‰

### ç«¯å£æ£€æŸ¥
- [ ] ç«¯å£ 8014 æœªè¢«å ç”¨ï¼ˆ`ss -tuln | grep 8014`ï¼‰
- [ ] å¦‚ä½¿ç”¨ Nginxï¼Œç«¯å£ 80/443 å¯ç”¨
- [ ] ECS å®‰å…¨ç»„è§„åˆ™å·²é…ç½®ï¼ˆå¼€æ”¾ 80/443ï¼Œå…³é—­ 8014 å¤–éƒ¨è®¿é—®ï¼‰

### æ–‡ä»¶å‡†å¤‡
- [ ] é¡¹ç›®æ–‡ä»¶å·²ä¸Šä¼ åˆ°æœåŠ¡å™¨
- [ ] `.env` æ–‡ä»¶å·²é…ç½®ï¼ˆ`DEEPSEEK_API_KEY` ç­‰ï¼‰
- [ ] æ‰€æœ‰è„šæœ¬æœ‰æ‰§è¡Œæƒé™ï¼ˆ`chmod +x deploy.sh`ï¼‰

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### 1. æ„å»ºé•œåƒ
```bash
cd /path/to/Director-Actor-Test-20251112
./deploy.sh build
```
- [ ] æ„å»ºæˆåŠŸï¼ˆæ— é”™è¯¯ï¼‰
- [ ] é•œåƒå¤§å°çº¦ 356MB
- [ ] é•œåƒå·²åˆ›å»ºï¼ˆ`docker images | grep screenplay-analysis`ï¼‰

### 2. å¯åŠ¨å®¹å™¨
```bash
./deploy.sh deploy
# æˆ–
docker-compose up -d
```
- [ ] å®¹å™¨åˆ›å»ºæˆåŠŸ
- [ ] å®¹å™¨çŠ¶æ€ä¸º `Up` ä¸” `healthy`
- [ ] ç«¯å£æ˜ å°„æ­£ç¡®ï¼ˆ`0.0.0.0:8014->8000/tcp`ï¼‰

### 3. éªŒè¯è¿è¡Œ
```bash
# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker ps | grep screenplay-web

# æµ‹è¯•å¥åº·ç«¯ç‚¹
curl http://localhost:8014/health
```
- [ ] å®¹å™¨æ­£åœ¨è¿è¡Œ
- [ ] å¥åº·æ£€æŸ¥è¿”å› 200 OK
- [ ] å“åº”åŒ…å« `"status": "healthy"`

---

## ğŸŒ Nginx é…ç½®ï¼ˆå¯é€‰ï¼‰

### å¦‚æœä½¿ç”¨ Nginx åå‘ä»£ç†

#### 1. å¤åˆ¶é…ç½®æ–‡ä»¶
```bash
sudo cp nginx.conf /etc/nginx/conf.d/screenplay.conf
# æˆ–
sudo cp nginx.conf /etc/nginx/sites-available/screenplay
sudo ln -s /etc/nginx/sites-available/screenplay /etc/nginx/sites-enabled/
```
- [ ] é…ç½®æ–‡ä»¶å·²å¤åˆ¶

#### 2. ä¿®æ”¹é…ç½®ï¼ˆå¦‚éœ€è¦ï¼‰
```bash
sudo nano /etc/nginx/conf.d/screenplay.conf
```
- [ ] `server_name` è®¾ç½®æ­£ç¡®ï¼ˆåŸŸåæˆ– `_`ï¼‰
- [ ] `upstream` åœ°å€æ­£ç¡®ï¼ˆ`127.0.0.1:8014`ï¼‰

#### 3. æµ‹è¯•å’Œé‡è½½
```bash
sudo nginx -t
sudo systemctl reload nginx
```
- [ ] Nginx é…ç½®æµ‹è¯•é€šè¿‡
- [ ] Nginx é‡è½½æˆåŠŸ
- [ ] Nginx æœåŠ¡è¿è¡Œæ­£å¸¸ï¼ˆ`sudo systemctl status nginx`ï¼‰

#### 4. éªŒè¯è®¿é—®
```bash
curl http://localhost/
# æˆ–
curl http://your-domain.com/
```
- [ ] é€šè¿‡ Nginx å¯ä»¥è®¿é—®
- [ ] é¦–é¡µè¿”å› 200 OK

---

## âœ… åŠŸèƒ½æµ‹è¯•

### åŸºç¡€åŠŸèƒ½
- [ ] é¦–é¡µå¯è®¿é—®ï¼ˆ`http://server-ip:8014` æˆ– `http://your-domain.com`ï¼‰
- [ ] å¯ä»¥çœ‹åˆ°ä¸Šä¼ è¡¨å•
- [ ] é™æ€èµ„æºåŠ è½½æ­£å¸¸ï¼ˆCSS/JSï¼‰

### ä¸Šä¼ å’Œåˆ†æ
- [ ] å¯ä»¥ä¸Šä¼  JSON æ–‡ä»¶
- [ ] æ–‡ä»¶ä¸Šä¼ æˆåŠŸå¹¶è¿”å› job_id
- [ ] åˆ†æä»»åŠ¡æ­£å¸¸æ‰§è¡Œï¼ˆæŸ¥çœ‹æ—¥å¿—ï¼š`docker logs -f screenplay-web`ï¼‰
- [ ] ç»“æœé¡µé¢æ­£å¸¸æ˜¾ç¤º
- [ ] Markdown æŠ¥å‘Šç”ŸæˆæˆåŠŸ

### TXT è§£æï¼ˆå¦‚æœä½¿ç”¨ï¼‰
- [ ] å¯ä»¥ä¸Šä¼  TXT æ–‡ä»¶
- [ ] è§£æé¢„è§ˆé¡µé¢æ­£å¸¸
- [ ] å¯ä»¥ç»§ç»­åˆ°åˆ†ææµç¨‹

---

## ğŸ”’ å®‰å…¨æ£€æŸ¥

### é˜²ç«å¢™é…ç½®
```bash
# Ubuntu/Debian
sudo ufw status

# åº”è¯¥å…è®¸çš„ç«¯å£
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw allow 22/tcp

# åº”è¯¥æ‹’ç»å¤–éƒ¨è®¿é—®çš„ç«¯å£
sudo ufw deny 8014/tcp
```
- [ ] é˜²ç«å¢™å·²å¯ç”¨
- [ ] 80/443 ç«¯å£å·²å¼€æ”¾ï¼ˆå¦‚ä½¿ç”¨ Nginxï¼‰
- [ ] 8014 ç«¯å£æ‹’ç»å¤–éƒ¨è®¿é—®ï¼ˆä»…æœ¬åœ°ï¼‰
- [ ] SSH ç«¯å£å·²å¼€æ”¾ï¼ˆç”¨äºç®¡ç†ï¼‰

### ECS å®‰å…¨ç»„
åœ¨ ECS æ§åˆ¶å°æ£€æŸ¥ï¼š
- [ ] HTTP (80) - æ¥æº: 0.0.0.0/0
- [ ] HTTPS (443) - æ¥æº: 0.0.0.0/0
- [ ] SSH (22) - æ¥æº: ä½ çš„ IP
- [ ] **8014 ç«¯å£æœªå¼€æ”¾**ï¼ˆé‡è¦ï¼ï¼‰

### HTTPS é…ç½®ï¼ˆæ¨èï¼‰
```bash
sudo certbot --nginx -d your-domain.com
```
- [ ] SSL è¯ä¹¦å·²å®‰è£…
- [ ] HTTPS è®¿é—®æ­£å¸¸
- [ ] HTTP è‡ªåŠ¨è·³è½¬åˆ° HTTPS

---

## ğŸ“Š æ€§èƒ½å’Œç›‘æ§

### èµ„æºä½¿ç”¨
```bash
docker stats screenplay-web --no-stream
```
- [ ] CPU ä½¿ç”¨ç‡åˆç†ï¼ˆ< 50%ï¼‰
- [ ] å†…å­˜ä½¿ç”¨åˆç†ï¼ˆ< 500MB ç©ºé—²æ—¶ï¼‰
- [ ] æ— å¼‚å¸¸é‡å¯

### æ—¥å¿—æ£€æŸ¥
```bash
# å®¹å™¨æ—¥å¿—
docker logs --tail 50 screenplay-web

# Nginx æ—¥å¿—ï¼ˆå¦‚æœä½¿ç”¨ï¼‰
sudo tail -50 /var/log/nginx/screenplay_access.log
sudo tail -50 /var/log/nginx/screenplay_error.log
```
- [ ] æ— é”™è¯¯æ—¥å¿—
- [ ] è®¿é—®æ—¥å¿—æ­£å¸¸è®°å½•
- [ ] å¯åŠ¨æ—¥å¿—æ— å¼‚å¸¸

### æ•°æ®æŒä¹…åŒ–
```bash
docker volume ls | grep screenplay
docker volume inspect director-actor-test-20251112_screenplay-data
```
- [ ] æ•°æ®å·å·²åˆ›å»º
- [ ] æŒ‚è½½ç‚¹æ­£ç¡®

---

## ğŸ”„ éƒ¨ç½²åé…ç½®

### è‡ªåŠ¨é‡å¯
- [ ] å®¹å™¨é…ç½®äº†è‡ªåŠ¨é‡å¯ï¼ˆ`--restart unless-stopped`ï¼‰
- [ ] æµ‹è¯•é‡å¯ï¼š`docker restart screenplay-web`
- [ ] å®¹å™¨è‡ªåŠ¨æ¢å¤

### å®šæ—¶å¤‡ä»½ï¼ˆå¯é€‰ï¼‰
```bash
# åˆ›å»ºå¤‡ä»½è„šæœ¬
cat > /path/to/backup.sh << 'EOF'
#!/bin/bash
BACKUP_DIR=/path/to/backups
DATE=$(date +%Y%m%d_%H%M%S)
docker run --rm \
  -v screenplay-data:/data \
  -v $BACKUP_DIR:/backups \
  alpine tar czf /backups/screenplay-backup-$DATE.tar.gz -C /data .
find $BACKUP_DIR -name "screenplay-backup-*.tar.gz" -mtime +7 -delete
EOF

chmod +x /path/to/backup.sh

# æ·»åŠ åˆ° crontabï¼ˆæ¯å¤©å‡Œæ™¨ 2 ç‚¹å¤‡ä»½ï¼‰
crontab -e
# æ·»åŠ : 0 2 * * * /path/to/backup.sh
```
- [ ] å¤‡ä»½è„šæœ¬å·²åˆ›å»º
- [ ] Cron ä»»åŠ¡å·²é…ç½®
- [ ] æµ‹è¯•å¤‡ä»½æˆåŠŸ

---

## ğŸ“ æ•…éšœæ’æŸ¥æ£€æŸ¥

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œæ£€æŸ¥ä»¥ä¸‹é¡¹ç›®ï¼š

### å®¹å™¨æ— æ³•å¯åŠ¨
- [ ] æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ï¼ˆ`docker logs screenplay-web`ï¼‰
- [ ] æ£€æŸ¥ `.env` æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä¸”é…ç½®æ­£ç¡®
- [ ] æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨ï¼ˆ`ss -tuln | grep 8014`ï¼‰
- [ ] æ£€æŸ¥ç£ç›˜ç©ºé—´ï¼ˆ`df -h`ï¼‰

### æ— æ³•è®¿é—®ç½‘é¡µ
- [ ] å®¹å™¨æ˜¯å¦è¿è¡Œï¼ˆ`docker ps | grep screenplay-web`ï¼‰
- [ ] ç«¯å£æ˜ å°„æ˜¯å¦æ­£ç¡®ï¼ˆ`docker ps` æŸ¥çœ‹ PORTS åˆ—ï¼‰
- [ ] é˜²ç«å¢™è§„åˆ™æ˜¯å¦æ­£ç¡®
- [ ] Nginx é…ç½®æ˜¯å¦æ­£ç¡®ï¼ˆå¦‚ä½¿ç”¨ï¼‰
- [ ] æµ‹è¯•ç›´æ¥è®¿é—®ç«¯å£ 8014ï¼ˆ`curl http://localhost:8014/health`ï¼‰

### åˆ†æä»»åŠ¡å¤±è´¥
- [ ] API key æ˜¯å¦æ­£ç¡®é…ç½®
- [ ] æŸ¥çœ‹å®¹å™¨æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯
- [ ] ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸ï¼ˆèƒ½å¦è®¿é—® DeepSeek APIï¼‰
- [ ] ä¸Šä¼ çš„æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®

### Nginx 502 é”™è¯¯
- [ ] å®¹å™¨æ˜¯å¦è¿è¡Œ
- [ ] Nginx upstream åœ°å€æ˜¯å¦æ­£ç¡®ï¼ˆ127.0.0.1:8014ï¼‰
- [ ] Nginx é…ç½®è¯­æ³•æ˜¯å¦æ­£ç¡®ï¼ˆ`sudo nginx -t`ï¼‰
- [ ] æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿—

---

## ğŸ‰ éƒ¨ç½²æˆåŠŸç¡®è®¤

å…¨éƒ¨æ£€æŸ¥é€šè¿‡åï¼Œç¡®è®¤ä»¥ä¸‹åŠŸèƒ½ï¼š

- [ ] âœ… å®¹å™¨å¥åº·è¿è¡Œ
- [ ] âœ… Web UI å¯è®¿é—®
- [ ] âœ… æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æ­£å¸¸
- [ ] âœ… ä¸‰é˜¶æ®µåˆ†æå®Œæ•´æ‰§è¡Œ
- [ ] âœ… ç»“æœé¡µé¢æ­£å¸¸æ˜¾ç¤º
- [ ] âœ… Markdown æŠ¥å‘Šç”Ÿæˆ
- [ ] âœ… Nginx åå‘ä»£ç†æ­£å¸¸ï¼ˆå¦‚ä½¿ç”¨ï¼‰
- [ ] âœ… HTTPS é…ç½®æ­£å¸¸ï¼ˆå¦‚ä½¿ç”¨ï¼‰
- [ ] âœ… å®‰å…¨è§„åˆ™é…ç½®æ­£ç¡®
- [ ] âœ… æ—¥å¿—è®°å½•æ­£å¸¸
- [ ] âœ… è‡ªåŠ¨é‡å¯é…ç½®ç”Ÿæ•ˆ

---

## ğŸ“ è·å–å¸®åŠ©

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š

1. **ECS_DEPLOYMENT_GUIDE.md** - å®Œæ•´éƒ¨ç½²æŒ‡å—
2. **DOCKER_DEPLOYMENT_SUMMARY.md** - Docker éƒ¨ç½²æ€»ç»“
3. **æ•…éšœæ’æŸ¥éƒ¨åˆ†** - æŸ¥çœ‹å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ

æŸ¥çœ‹æ—¥å¿—ï¼š
```bash
# å®¹å™¨æ—¥å¿—
docker logs -f screenplay-web

# Nginx æ—¥å¿—
sudo tail -f /var/log/nginx/screenplay_error.log
```

---

**ç‰ˆæœ¬**: v2.4.0
**ç«¯å£**: 8014 (ä¸»æœº) â†’ 8000 (å®¹å™¨)
**æœ€åæ›´æ–°**: 2025-11-14
**çŠ¶æ€**: âœ… å¯ç”¨äºç”Ÿäº§éƒ¨ç½²
